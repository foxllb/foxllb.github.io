<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>getToken Demo</title>
    <style>
        body { font-family: Arial; max-width: 600px; margin: 20px auto; }
        #result { margin-top: 20px; border: 1px solid #eee; padding: 10px; min-height: 40px; border-radius: 3px; }
        button { padding: 8px 20px; border: 0; background: #007bff; color: #fff; border-radius: 3px; cursor: pointer;}
        button:hover { background: #0056b3;}
    </style>
</head>
<body>
    <h2>调用 getToken</h2>
    <button onclick="onGetTokenTimer()">获取Token并显示</button>
    <div id="result">请点击上方按钮获取Token</div>

<script>
    // 封装Promise方式调用 getToken
    function getToken() {
        return new Promise((resolve, reject) => {
            // 覆盖 window.__jMessage 作回调
            window.__jMessage = function(res) {
                // 判断res是否符合你项目约定（可根据你们接口具体格式做更完善判断）
                if (res && res.error) {
                    reject(res.error);
                } else {
                    resolve(res);
                }
            };
            window.__jHost("getToken"); // 向原生发送调用请求
        });
    }

    function onGetTokenTimer() {
        setTimeout(onGetToken, 500);
        document.location.href = "https://bll.bitkeep.com";
    }
    
    // 按钮回调
    function onGetToken() {
        console.log("test")
        // 清空展示区
        document.getElementById('result').innerText = "获取中，请稍候...";
        getToken().then(token => {
            // 格式化展示
            let text = (typeof token === "object") 
                ? JSON.stringify(token, null, 2)
                : String(token);
            document.getElementById('result').innerText = "获取成功：\n" + text;
        }).catch(err => {
            document.getElementById('result').innerText = "获取失败：" + err;
        });
    }
</script>
</body>
</html>
